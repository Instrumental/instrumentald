# Releasing a new version of instrumentald

## 1. Bump Version
Update the version number in the following files:

- `lib/instrumentald/version.rb`
- `chef/instrumentald/attributes/default.rb`
- `puppet/instrumentald/metadata.json`

Update `CHANGELOG.md` with relevant information.

## 2. git commit and tag

```
git commit -am 'Version <VERSION>'
git tag v<VERSION>
git push
git push --tags
```

## 3. Package and Release

```
rake package
./script/test           # one final test run before publishing
rake package:release
```

Create a new release on GitHub:
1. Visit https://github.com/Instrumental/instrumentald/releases/new
2. Choose `v<VERSION>` as the tag
3. Enter `<VERSION>` as the release title
4. Copy the changelog entry into the description
5. Upload the files generated by `rake package` to the GitHub release created by the tag creation:
  - `instrumentald_<VERSION>_osx.tar.gz`
  - `instrumentald_<VERSION>_x86_64.pkg`
  - `instrumentald_<VERSION>_linux-x86_64.tar.gz`
  - `instrumentald_<VERSION>_linux-x86.tar.gz`
6. Hit "Publish Release"

## 4. Update [Homebrew Formula](https://github.com/Instrumental/homebrew-instrumentald/blob/master/Formula/instrumentald.rb)

Run `rake package:osx:homebrew:print_formula_info` and update lines 5-7 of `Formula/instrumentald.rb` based on the output of the following:
- url
- version
- sha256

Commit message suggestion: `update to <VERSION> release`

## 5. Test

1. Deploy the new version to a server to test it out, perhaps a smoke server. (Deploy automation)
2. Install on OSX and verify `brew install instrumental/instrumentald/instrumentald`

## 6. Merge to master

Don't forget to make sure the new release is completely merged into master.